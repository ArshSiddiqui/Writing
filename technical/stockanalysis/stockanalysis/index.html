<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Stock Analysis#Given the ubiquity of the financial market in our day to day lives, and with my personal interest in stocks I figured that now would be as good of a time as any to learn how to analyze stocks with code.
Given its current ubiquity in the field and with its abundance of libraries that would make learning more about this field, I elected to proceed with Python.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Stock Analysis" />
<meta property="og:description" content="Stock Analysis#Given the ubiquity of the financial market in our day to day lives, and with my personal interest in stocks I figured that now would be as good of a time as any to learn how to analyze stocks with code.
Given its current ubiquity in the field and with its abundance of libraries that would make learning more about this field, I elected to proceed with Python." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://arshsiddiqui.github.io/writing/technical/stockanalysis/stockanalysis/" /><meta property="article:section" content="technical" />


<title>Stock Analysis | Arsh Siddiqui</title>
<link rel="manifest" href="/writing/manifest.json">
<link rel="icon" href="/writing/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/writing/book.min.b3488045b94246c08cb956e8a82d99944a7cbd581bf976a700e281bbb73b1a07.css" integrity="sha256-s0iARblCRsCMuVboqC2ZlEp8vVgb&#43;XanAOKBu7c7Ggc=" crossorigin="anonymous">
  <script defer src="/writing/flexsearch.min.js"></script>
  <script defer src="/writing/en.search.min.ce2ff47f9e78607ca1bc4d33ad848f480df78ce50156145d0cf3476454780e95.js" integrity="sha256-zi/0f554YHyhvE0zrYSPSA33jOUBVhRdDPNHZFR4DpU=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/writing/"><span>Arsh Siddiqui</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/writing/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="https://arshsiddiqui.github.io/writing/fr/">
          French
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  <ul>
<li><a href="/writing/technical/">Technical</a></li>
<li><a href="/writing/poetry/">Poetry</a></li>
<li><a href="/writing/bookreviews/">Book Reviews</a></li>
<li><a href="/writing/oldwriting/">Old Writing</a></li>
</ul>










</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/writing/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Stock Analysis</strong>

  <label for="toc-control">
    
    <img src="/writing/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents"></nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="stock-analysis">
  Stock Analysis
  <a class="anchor" href="#stock-analysis">#</a>
</h1>
<p>Given the ubiquity of the financial market in our day to day lives, and with my personal interest in
stocks I figured that now would be as good of a time as any to learn how to analyze stocks with code.</p>
<p>Given its current ubiquity in the field and with its abundance of libraries that would make learning
more about this field, I elected to proceed with Python. One of the main reasons for this choice, outside
of what I had just outlined, is that using the Pandas library allows us to quickly and easily gain stock
information for a given stock for a period of time.</p>
<pre><code>from pandas_datareader import data
import datetime

today = datetime.date.today()
start_date = str(today - datetime.timedelta(1000))
end_date = str(today)

panel_data = data.DataReader('AAPL', 'yahoo', start_date, end_date)
panel_data
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">Date</th>
<th style="text-align:left">High</th>
<th style="text-align:left">Low</th>
<th style="text-align:left">Open</th>
<th style="text-align:left">Close</th>
<th style="text-align:left">Volume</th>
<th style="text-align:left">Adj Close</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2019-08-28</td>
<td style="text-align:left">51.430000</td>
<td style="text-align:left">50.830002</td>
<td style="text-align:left">51.025002</td>
<td style="text-align:left">51.382500</td>
<td style="text-align:left">63755200.0</td>
<td style="text-align:left">50.340683</td>
</tr>
<tr>
<td style="text-align:left">2019-08-29</td>
<td style="text-align:left">52.330002</td>
<td style="text-align:left">51.665001</td>
<td style="text-align:left">52.125000</td>
<td style="text-align:left">52.252499</td>
<td style="text-align:left">83962000.0</td>
<td style="text-align:left">51.193043</td>
</tr>
<tr>
<td style="text-align:left">2019-08-30</td>
<td style="text-align:left">52.612499</td>
<td style="text-align:left">51.799999</td>
<td style="text-align:left">52.540001</td>
<td style="text-align:left">52.185001</td>
<td style="text-align:left">84573600.0</td>
<td style="text-align:left">51.126915</td>
</tr>
<tr>
<td style="text-align:left">2019-09-03</td>
<td style="text-align:left">51.744999</td>
<td style="text-align:left">51.055000</td>
<td style="text-align:left">51.607498</td>
<td style="text-align:left">51.424999</td>
<td style="text-align:left">80092000.0</td>
<td style="text-align:left">50.382324</td>
</tr>
<tr>
<td style="text-align:left">2019-09-04</td>
<td style="text-align:left">52.369999</td>
<td style="text-align:left">51.830002</td>
<td style="text-align:left">52.097500</td>
<td style="text-align:left">52.297501</td>
<td style="text-align:left">76752400.0</td>
<td style="text-align:left">51.237133</td>
</tr>
<tr>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2022-05-17</td>
<td style="text-align:left">149.770004</td>
<td style="text-align:left">146.679993</td>
<td style="text-align:left">148.860001</td>
<td style="text-align:left">149.240005</td>
<td style="text-align:left">78336300.0</td>
<td style="text-align:left">149.240005</td>
</tr>
<tr>
<td style="text-align:left">2022-05-18</td>
<td style="text-align:left">147.360001</td>
<td style="text-align:left">139.899994</td>
<td style="text-align:left">146.850006</td>
<td style="text-align:left">140.820007</td>
<td style="text-align:left">109742900.0</td>
<td style="text-align:left">140.820007</td>
</tr>
<tr>
<td style="text-align:left">2022-05-19</td>
<td style="text-align:left">141.660004</td>
<td style="text-align:left">136.600006</td>
<td style="text-align:left">139.880005</td>
<td style="text-align:left">137.350006</td>
<td style="text-align:left">136095600.0</td>
<td style="text-align:left">137.350006</td>
</tr>
<tr>
<td style="text-align:left">2022-05-20</td>
<td style="text-align:left">140.699997</td>
<td style="text-align:left">132.610001</td>
<td style="text-align:left">139.089996</td>
<td style="text-align:left">137.589996</td>
<td style="text-align:left">137194600.0</td>
<td style="text-align:left">137.589996</td>
</tr>
<tr>
<td style="text-align:left">2022-05-23</td>
<td style="text-align:left">143.259995</td>
<td style="text-align:left">137.649994</td>
<td style="text-align:left">137.789993</td>
<td style="text-align:left">143.110001</td>
<td style="text-align:left">116301300.0</td>
<td style="text-align:left">143.110001</td>
</tr>
</tbody>
</table>
<p>With this data gained, we can quickly single out the Close column such that we can start visualizing
our stock data. Sometimes when looking at stock data, or when visualizing it, we may want to smooth out
the data so that we can avoid shifted perceptions due to temporary changes in stock valuation. This may
offer us a more comprehensive look at our data, that is not skewed by any minor blip.</p>
<p>We can change the duration of the rolling average, based upon how much smoothing we may want. For example,
we could have a shorter smoothing of just 20 days, or longer smoothing of 100 days.</p>
<p>Before I did that, though, I first had to reindex my data. Because financial data is collected on weekdays,
I had to account for that fact by adding in all of the non-included days in our data between the start and
end dates we provided. We can fill these empty spots in with na and then we can reindex those to copy the
previously entered piece of data into that box.</p>
<pre><code>import pandas as pd
import matplotlib.pyplot as plt

close = panel_data['Close']

all_weekdays = pd.date_range(start=start_date, end=end_date, freq='B')

close = close.reindex(all_weekdays)

close = close.fillna(method='ffill')

short_rolling_msft = close.rolling(window=20).mean()
long_rolling_msft = close.rolling(window=100).mean()

fig, ax = plt.subplots(figsize=(16,9))

ax.plot(close.index, close, label='AAPL')
ax.plot(short_rolling_msft.index, short_rolling_msft, label='20 days rolling')
ax.plot(long_rolling_msft.index, long_rolling_msft, label='100 days rolling')

ax.set_xlabel('Date')
ax.set_ylabel('Adjusted closing price ($)')
ax.legend()
</code></pre>
<p><img src="../firstchart.png" alt="image" /></p>
<p>When developing a stock strategy, or trading strategy, we will want to analyze the change in the returns
of our stock over time. One way to do this would be to look at relative returns. A relative return is the
amount of return our stock will get after some timeline relative to some benchmark return. The formula for
relative returns looks as follows.</p>

<link rel="stylesheet" href="/writing/katex/katex.min.css" />
<script defer src="/writing/katex/katex.min.js"></script>
<script defer src="/writing/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \[
r_{relative}(t) = \frac{p(t) - p(t - 1)}{p(t - 1)}\]
</span>

<p>Another way to do this would be through logarithmic returns, the formula which is as follows.</p>
<span>
  \[
r(t) = log(\frac{p(t)}{p(t - 1)})\]
</span>

<p>There are many reasons why we may wish to use a log return, rather than relative returns, some
of which would be that they capture the compounding effect. When we consider that financial investments
such as these are compounded over many points in time, we may find this compounding important to capture in
our data, which make log returns more appealing in their use.</p>
<pre><code>import numpy as np

log_returns = np.log(close).diff()

fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(16, 12))

ax1.plot(log_returns.index, log_returns.cumsum(), label='AAPL')

ax1.set_ylabel('Cumulative log returns')
ax1.set_xlabel('Date')
ax1.legend(loc='upper left')

ax2.plot(log_returns.index, 100*(np.exp(log_returns.cumsum()) - 1), label='AAPL')

ax2.set_ylabel('Total relative returns (%)')
ax2.set_xlabel('Date')
ax2.legend(loc='upper left')

plt.show()
</code></pre>
<p><img src="../secondcharts.png" alt="image" /></p>
<p>While analyzing our data visually is indeed very useful, it is also helpful to analyze our data
quantitatively. Here, we can also use some Python to calculate the returns between our start and end date
and we can also use this to determine an average return across each year (or month if we wanted to do that
as well).</p>
<pre><code>days = 1000
years = days / 365

final_returns = 100*(np.exp(log_returns.cumsum()) - 1)[-1]

print('Return from start date to end date is: ' + '{:.2f}'.format(final_returns) + '%')

final_returns_per_year = final_returns / years

print('Average yearly return: ' + '{:.2f}'.format(final_returns_per_year) + '%')
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-latex" data-lang="latex"><span style="display:flex;"><span>Return from start date to end date is: 178.52<span style="color:#75715e">%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Average yearly return: 65.16<span style="color:#75715e">%
</span></span></span></code></pre></div><p>When we previously looked at our rolling averages of stock returns, we were using a method known as
the &ldquo;simple moving average&rdquo; (SMA). This method is evidently fairly easy to create, and shows us the general
trend of our stock movement. Another method is known as the &ldquo;exponential moving average&rdquo; (EMA). This method
of moving average places more importance/weight on more recent data points, so it accounts more strongly for
recent changes in price.</p>
<p>With the EMA, we can also do it across a time period, perhaps 20 or even 100 days. Below I have graphed the
regular stock price and both the EMA and SMA across 20 and 100 days, so as to easily see their differences.</p>
<pre><code>ema_short = close.ewm(span = 20, adjust=False).mean()
ema_long = close.ewm(span = 100, adjust=False).mean()

fig, ax = plt.subplots(figsize=(16,9))

ax.plot(close.index, close, label='AAPL')
ax.plot(short_rolling_msft.index, short_rolling_msft, label='20 days SMA')
ax.plot(long_rolling_msft.index, long_rolling_msft, label='100 days SMA')
ax.plot(ema_short.index, ema_short, label=&quot;20 days EMA&quot;)
ax.plot(ema_long.index, ema_long, label=&quot;100 days EMA&quot;)

ax.set_xlabel('Date')
ax.set_ylabel('Adjusted closing price ($)')
ax.legend()
</code></pre>
<p><img src="../thirdchart.png" alt="image" /></p>
<p>Before making any investment it is critical to know the volatility of a stock, as it can give us insight
into how risky the stock may be as an investment. Volatility measures how dispersed, or spread out, the
returns for our stock is. Thus, the greater the volatility is, the riskier of an investment it would be.
It can be calculated as the standard deviation between returns of the stock. Below you can see the measured
stock volatility based upon the log returns of the stock price and its frequency.</p>
<pre><code>ema_short = close.ewm(span = 20, adjust=False).mean()
ema_long = close.ewm(span = 100, adjust=False).mean()

fig, ax = plt.subplots(figsize=(16,9))

ax.plot(close.index, close, label='AAPL')
ax.plot(short_rolling_msft.index, short_rolling_msft, label='20 days SMA')
ax.plot(long_rolling_msft.index, long_rolling_msft, label='100 days SMA')
ax.plot(ema_short.index, ema_short, label=&quot;20 days EMA&quot;)
ax.plot(ema_long.index, ema_long, label=&quot;100 days EMA&quot;)

ax.set_xlabel('Date')
ax.set_ylabel('Adjusted closing price ($)')
ax.legend()
</code></pre>
<p><img src="../fourthchart.png" alt="image" /></p>
<p>There is a lot more analysis that can and should be done to better understand investments, in this case stock
investments, so I intend to come back to this topic in the future to learn about more methods for financial
analysis.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents"></nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












